# ğŸ“Š Sistema de GrÃ¡ficos - DocumentaciÃ³n

## ğŸ¯ CaracterÃ­sticas Implementadas

El nuevo sistema de grÃ¡ficos incluye todas las funcionalidades del archivo `charts.js` original, pero de forma modular y mantenible:

### âœ… Funcionalidades Principales

1. **GestiÃ³n Centralizada de Instancias**
   - Todas las instancias de grÃ¡ficos se registran en `ChartsManager`
   - Previene memory leaks mediante limpieza automÃ¡tica

2. **Redimensionamiento AutomÃ¡tico**
   - Detecta cambios en el tamaÃ±o de ventana
   - Usa debouncing (200ms) para optimizar performance
   - Redimensiona todos los grÃ¡ficos registrados automÃ¡ticamente

3. **DetecciÃ³n de Cambio de Tema**
   - Observer de mutaciones en la clase `dark` del `<html>`
   - Recarga automÃ¡tica de grÃ¡ficos al cambiar tema
   - Delay de 50ms para sincronizar con Alpine.js

4. **Limpieza de Recursos**
   - Cleanup automÃ¡tico al salir de la pÃ¡gina (`beforeunload`)
   - DesconexiÃ³n de observers y listeners
   - LiberaciÃ³n de instancias de ECharts

---

## ğŸ—ï¸ Estructura Actualizada

```text
resources/js/charts/
â”œâ”€ utils/
â”‚  â”œâ”€ theme.js                    # Utilidades de tema
â”‚  â”œâ”€ chartsManager.js            # ğŸ†• Gestor central de grÃ¡ficos
â”‚  â””â”€ shortName.js                # Utilidad para abreviar nombres
â””â”€ general/
    â”œâ”€ index.js                    # ğŸ”„ Actualizado - InicializaciÃ³n principal
    â”œâ”€ filtersManager.js           # GestiÃ³n de filtros
    â”œâ”€ statisticsCounters.js       # Contadores de estadÃ­sticas
    â”œâ”€ programAttendancesBar.js    # ğŸ”„ Ejemplo actualizado
    â”œâ”€ programParticipantsPie.js
    â”œâ”€ eventsOverTime.js
    â”œâ”€ attendancesOverTime.js
    â”œâ”€ topEvents.js
    â”œâ”€ topParticipants.js
    â”œâ”€ topUsers.js
    â”œâ”€ eventsByRole.js
    â””â”€ eventsByUser.js
```

---

## ğŸš€ Uso

### InicializaciÃ³n

```javascript
// En tu blade o script principal
window.createGeneralCharts();
```

### Limpieza Manual (opcional)

```javascript
// Si necesitas limpiar manualmente
window.cleanupGeneralCharts();
```

### Debugging

```javascript
// Inspeccionar el estado del manager
console.log(window.chartsManager);

// Ver grÃ¡ficos registrados
console.log(window.chartsManager.charts);

// Redimensionar manualmente
window.chartsManager.resizeAll();
```

---

## ğŸ”§ Actualizar GrÃ¡ficos Existentes

Para actualizar tus grÃ¡ficos existentes al nuevo sistema, sigue este patrÃ³n:

```javascript
// Antes
export function renderMyChart(charts) {
  const el = document.getElementById('chart_my_chart');
  if (!el) return;

  if (charts.myChart) echarts.dispose(el);
  charts.myChart = echarts.init(el);
  
  // ... configuraciÃ³n del grÃ¡fico
}

// DespuÃ©s
import { chartsManager } from '../utils/chartsManager.js';

export function renderMyChart(charts) {
  const el = document.getElementById('chart_my_chart');
  if (!el) return;

  const chartId = 'myChart';

  // Limpiar instancia anterior
  if (charts[chartId]) {
    echarts.dispose(el);
    chartsManager.dispose(chartId);
  }

  // Crear y registrar nueva instancia
  charts[chartId] = echarts.init(el);
  chartsManager.register(chartId, charts[chartId]);
  
  // ... configuraciÃ³n del grÃ¡fico
}
```

---

## ğŸ“‹ Eventos Personalizados

### `charts-theme-changed`

Disparado cuando cambia el tema (light/dark):

```javascript
window.addEventListener('charts-theme-changed', (event) => {
  console.log('Tema cambiado:', event.detail.isDark);
  // Los grÃ¡ficos se recargan automÃ¡ticamente
});
```

### `statistics-filters-changed`

Disparado cuando cambian los filtros:

```javascript
window.addEventListener('statistics-filters-changed', (event) => {
  console.log('Filtros actualizados:', event.detail.filters);
  // Los grÃ¡ficos se recargan automÃ¡ticamente
});
```

---

## ğŸ¨ Beneficios del Nuevo Sistema

### 1. **Sin Memory Leaks**
- Todas las instancias se limpian correctamente
- Los observers se desconectan al salir

### 2. **Mejor Performance**
- Debouncing en resize events
- Manejo eficiente de cambios de tema

### 3. **CÃ³digo MÃ¡s Limpio**
- SeparaciÃ³n de responsabilidades
- ReutilizaciÃ³n de lÃ³gica comÃºn
- MÃ¡s fÃ¡cil de mantener y testear

### 4. **Debugging Mejorado**
- Manager accesible globalmente
- Logs informativos en consola
- FÃ¡cil inspecciÃ³n del estado

---

## âš ï¸ Consideraciones

1. **Orden de ImportaciÃ³n**: AsegÃºrate de importar `chartsManager` antes de usarlo
2. **IDs Ãšnicos**: Cada grÃ¡fico debe tener un ID Ãºnico en el manager
3. **Limpieza**: El sistema se limpia automÃ¡ticamente, pero puedes forzar limpieza si necesitas

---

## ğŸ” ComparaciÃ³n con charts.js Original

| CaracterÃ­stica | charts.js | Nuevo Sistema |
|---------------|-----------|---------------|
| Redimensionamiento | âœ… | âœ… |
| DetecciÃ³n de tema | âœ… | âœ… |
| Cleanup automÃ¡tico | âœ… | âœ… |
| Modular | âŒ | âœ… |
| Reutilizable | âŒ | âœ… |
| Debugging | âš ï¸ | âœ… |
| Memory leaks | âš ï¸ | âœ… |
| CÃ³digo limpio | âŒ | âœ… |

---

## ğŸ› Troubleshooting

### Los grÃ¡ficos no se redimensionan
- Verifica que `chartsManager.initGlobalListeners()` se haya llamado
- Revisa la consola por errores

### Los grÃ¡ficos no cambian de tema
- Verifica que el elemento `<html>` tenga la clase `dark` cuando corresponda
- AsegÃºrate de que el observer estÃ© activo: `window.chartsManager.themeObserver`

### Memory leaks
- Llama a `cleanupGeneralCharts()` antes de cambiar de pÃ¡gina
- Verifica que todos los grÃ¡ficos estÃ©n registrados en el manager

---

## ğŸ“š PrÃ³ximos Pasos

Para aplicar el nuevo sistema a todos los grÃ¡ficos:

1. Actualiza cada archivo de grÃ¡fico siguiendo el patrÃ³n de `programAttendancesBar.js`
2. Importa y usa `chartsManager` en cada uno
3. Registra cada instancia con un ID Ãºnico
4. Prueba el redimensionamiento y cambio de tema

---

**Â¿Preguntas?** Revisa el cÃ³digo de `chartsManager.js` y `index.js` para mÃ¡s detalles.
